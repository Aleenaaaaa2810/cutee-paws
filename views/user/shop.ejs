<%- include("../../views/partials/user/header") %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">


<style>
   a.active, .price-button.active {

  transform: scale(1.05);
  font-weight: bold;
   margin-left: 50px;
}
 .main-container {
   max-width: 1200px;
   margin: 0 auto;
   padding: 20px;
 }
 .shop-topbar {
   display: flex;
   justify-content: space-between;
   align-items: center;
   margin-bottom: 20px;
 }

 .search-form {
   display: flex;
   align-items: center;
   background-color: #f1f1f1;
   border-radius: 25px;
   overflow: hidden;
   max-width: 289px;
   box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
 }

 .search-input {
   flex: 1;
   padding: 8px 10px;
   font-size: 14px;
   border: none;
   outline: none;
   background-color: transparent;
 }

 .search-button {
   padding: 8px 15px;
   background-color: #6A1E55;
   color: #fff;
   border: none;
   cursor: pointer;
   font-size: 14px;
   border-radius: 15px;
   margin-right: 5px;
   transition: background-color 0.3s, transform 0.2s;
 }

 .search-button:hover {
   background-color: #A64D79;
   transform: scale(1.05);
 }
 .sidebar {
  padding: 20px;
  border: 1px solid #ddd;
  background-color: #f9f9f9;
  border-radius: 8px;
  margin-bottom: 20px;
  width: 250px;
}

 .filter-section {
  text-align: left; /* Align all content inside the filter container to the left */
}

.filter-title {
  font-weight: bold;
  margin-bottom: 10px;
  font-size: 16px;
  color: #333;
  margin-left: -5px;

}

.filter-item {
  margin: 5px 0;
}

.filter-item a {
  text-decoration: none;
  color: #333;
  display: block; /* Ensures the link covers the full width */
  padding-left: 5px; /* Optional: Adds spacing for better readability */
}

.filter-item a:hover {
  color: #A64D79;
}

.filter-section ul {
  list-style-type: none; /* Remove bullet points */
  padding-left: 0; /* Remove extra padding */
  margin: 0; /* Remove margin */
}

 .product-list-container {
   display: flex;
   gap: 20px;
 }

 .product-grid {
   display: flex;
   flex-wrap: wrap;
   gap: 20px;
   width: calc(100% - 270px);
 }

 .product-card {
   width: calc(33.333% - 20px);
   border: 1px solid #ddd;
   padding: 15px;
   border-radius: 8px;
   text-align: center;
   position: relative;
 }

 .product-card img {
   max-width: 100%;
   height: auto;
   border-radius: 5px;
 }

 .wishlist-btn {
   position: absolute;
   top: 8px;
   right: 8px;
   background-color: rgba(237, 247, 247, 0.8);
   color: #1d1a1a;
   padding: 8px;
   border-radius: 50%;
   cursor: pointer;
 }

 .add-to-cart-btn {
   background-color: #3B1C32;
   color: #fff;
   padding: 10px;
   border: none;
   border-radius: 5px;
   cursor: pointer;
   width: 100%;
   margin-top: 10px;
 }

 .pagination {
   display: flex;
   justify-content: center;
   gap: 10px;
   margin: 20px 0;
 }

 .pagination a {
   padding: 8px 12px;
   background-color: #f0f0f0;
   border: 1px solid #ddd;
   color: #333;
   text-decoration: none;
 }

 .pagination .active {
   background-color: #A64D79;
   color: #fff;
 }

 .price-filter {
  text-align: left; /* Aligns the price filter content to the left */
  padding: 10px;
  background-color: #f9f9f9;
  border-radius: 8px;
  margin-top: 20px;
}

.price-options {
  display: flex;
  flex-direction: column; /* Stack the price buttons vertically */
  gap: 10px; /* Add space between buttons */
}
.price-options a {
  text-align: left; /* Ensures alignment for links or buttons inside */
}
.price-button {
  padding: 12px 20px;
  background-color: #f1f1f1;
  color: #333;
  border: 1px solid #ddd;
  border-radius: 30px;
  cursor: pointer;
  transition: background-color 0.3s, transform 0.2s;
  text-align: center;
  font-size: 14px;
  width: 100%; /* Ensures buttons take the full width of the container */
}

.price-button:hover {
  background-color: #A64D79;
  color: white;
  transform: scale(1.05);
}
 .price-button:active {
   transform: scale(0.95);
 }

 a.active, .price-button.active {
  /* background-color: #eae3e6; */
  /* color: white; */
  transform: scale(1.05);
  font-weight: bold;
}

.price-button.active {
  border: 2px solid #A64D79;
}
.sort-list {
  list-style-type: none; /* Remove default bullets */
  padding-left: 0; /* Remove default padding */
  margin: 0; /* Remove default margin */
}

.sort-list li {
  padding: 10px 15px;
  margin: 5px 0;
  cursor: pointer;
  font-size: 14px;
  transition: background-color 0.3s, transform 0.2s;
  border: 1px solid #ddd;
  border-radius: 8px;
  background-color: #f1f1f1;
}

.sort-list li:hover {
  background-color: #A64D79;
  color: white;
  transform: scale(1.05);
}

.sort-list li.active {
  background-color: #A64D79;
  color: white;
  font-weight: bold;
}
.rating-stars i {
  color: #ffdd57; /* Gold color for stars */
  font-size: 1.2rem; /* Smaller size for stars */
  margin-right: 3px;
}
</style>

<div class="main-container">
 <section class="shop-page container">
   <div class="shop-topbar">
     <div class="search-bar">
      <form action="/shop" method="GET" class="search-form">
         <input type="text" name="search" placeholder="Search items..." class="search-input" />
         <button type="submit" class="search-button">Search</button>
       </form>
     </div>
   </div>
  
   <div class="product-list-container">
     <aside class="sidebar">
       <div class="filter-section">
         <div class="filter-title">Categories</div>
         <div class="category-brand-container">
           <!-- Removed brand section -->
           <ul>
            
            <% for (let i = 0; i < category.length; i++) { %>
              <li class="filter-item">
                <a href="/shop?category=<%= category[i]._id %>&gte=<%= minPrice %>&lte=<%= maxPrice %>"
                   class="<%= selectedCategory === category[i]._id.toString() ? 'active' : '' %>">
                  <%= category[i].name %>
                </a>
              </li>
            <% } %>
          </ul>
          </ul>
         </div>
       </div>

       <div class="price-filter">
         <div class="filter-title">Filter by Price</div>
         <form id="price-filter-form">
           <div class="price-options">
            <div class="price-filter">
              <a href="/shop?category=<%= selectedCategory %>&gte=0&lte=499">
                <button type="button" class="price-button <%= minPrice === 0 && maxPrice === 499 ? 'active' : '' %>">
                  Under ₹500
                </button>
              </a>
              <a href="/shop?category=<%= selectedCategory %>&gte=500&lte=999">
                <button type="button" class="price-button <%= minPrice === 500 && maxPrice === 999 ? 'active' : '' %>">
                  ₹500 - ₹1000
                </button>
              </a>
              <a href="/shop?category=<%= selectedCategory %>&gte=1000&lte=1499">
                <button type="button" class="price-button <%= minPrice === 1000 && maxPrice === 1499 ? 'active' : '' %>">
                  ₹1000 - ₹1500
                </button>
              </a>
              <a href="/shop?category=<%= selectedCategory %>&gte=1500&lte=100000">
                <button type="button" class="price-button <%= minPrice === 1500 && maxPrice === 100000 ? 'active' : '' %>">
                  Above ₹1500
                </button>
              </a>
            </div>
           </div>
         </form>
       </div>
       
       <!-- <div>
        <ul  class="sort-list"></ul>>
          <li  class="sort-list">
            <a href="" class="<%= selectedSort === 'default' ? 'active' : '' %>">Sort list</a>
          </li >
          <li class="sort-list" >
            <a href="/shop?sort=lowToHigh" class="<%= selectedSort === 'lowToHigh' ? 'active' : '' %>">Price: Low to High</a>

          </li>

          <li class="sort-list">
            <a href="/shop?sort=highToLow" class="<%= selectedSort === 'highToLow' ? 'active' : '' %>">Price: High to Low</a>
          </li>
          <li class="sort-list">
            <a href="/shop?sort=aToZ" class="<%= selectedSort === 'aToZ' ? 'active' : '' %>">Name: A to Z</a>
          </li>
          <li class="sort-list">
            <a href="/shop?sort=zToA" class="<%= selectedSort === 'zToA' ? 'active' : '' %>">Name: Z to A</a>
          </li>
        </ul>
        
       </div> -->
       <div>
        <ul class="sort-list">
          <li>
            <a href="/shop" class="<%= selectedSort === 'default' ? 'active' : '' %>">FILTER</a>
          </li>
          <li>
            <a href="/shop?sort=lowToHigh" class="<%= selectedSort === 'lowToHigh' ? 'active' : '' %>">Price: Low to High</a>
          </li>
          <li>
            <a href="/shop?sort=highToLow" class="<%= selectedSort === 'highToLow' ? 'active' : '' %>">Price: High to Low</a>
          </li>
          <li>
            <a href="/shop?sort=aToZ" class="<%= selectedSort === 'aToZ' ? 'active' : '' %>">Name: A to Z</a>
          </li>
          <li>
            <a href="/shop?sort=zToA" class="<%= selectedSort === 'zToA' ? 'active' : '' %>">Name: Z to A</a>
          </li>
        </ul>
      </div>
      
     </aside>


     <main class="product-grid">
      <% for (let i = 0; i < products.length; i++) { %>
        <div class="product-card">
        
          <span class="wishlist-btn" onclick="addTowishlist('<%=products[i]._id%>')"><i class="fa-regular fa-heart"></i></span>  
          <!-- <a href="/productDetails?id=<%=products[i]._id %>"> -->
            <img src="/uploads/<%= products[i].productImage[0] %>" 
                 alt="<%= products[i].name %>" 
                 class="product-image" />
            <h4><%= products[i].name %></h4>
            
            <!-- Product Pricing -->
            <p>
              Price: ₹<%= products[i].salePrice.toLocaleString('en-IN') %>
              <span class="text-muted">
                <strike>₹<%=products[i].regularPrice.toLocaleString('en-IN') %></strike>
              
              </span>
            </p>
          </a>
          <div class="rating-stars">
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star-half-alt"></i>
          </div>
          <!-- Add to Cart Button -->
          <% if (products[i].quantity > 0) { %>
        
            <!-- onclick="addToCart('<%= products._id %>', '<%= products.name %>', '<%= products.salePrice %>')"> -->
             <!-- Product Details Button --><br>
<a href="/productDetails?id=<%= products[i]._id %>">
  <button class="add-to-cart-btn">
    View Details
  </button>
</a>
          <% } else { %>
            <span class="out-of-stock-message" style="color: #d9534f; font-weight: bold;">
              Out of Stock
            </span>
            <a href="/productDetails?id=<%= products[i]._id %>">
              <button class="add-to-cart-btn">
                View Details
              </button>
            </a>
          <% } %>
        </div>
      <% } %>
     
      
     </main>
   </div>

   <!-- Pagination -->
   <div class="pagination">
    <% if (currentpage > 1) { %>
      <a class="btn" href="/shop?page=<%= currentpage - 1 %>">Prev</a>
    <% } %>
    
    <% for (let i = 1; i <= totalPages; i++) { %>
      <a class="btn <%= currentpage === i ? 'active' : '' %>" href="/shop?page=<%= i %>"><%= i %></a>
    <% } %>
    
    <% if (currentpage < totalPages) { %>
      <a class="btn" href="/shop?page=<%= currentpage + 1 %>">Next</a>
    <% } %>
    
   </div>
  
 </section>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script>

function addToCart(productId, productName, productPrice) {
    // AJAX request to add the product to the cart
    $.ajax({
      url: '/cart/add',
      method: 'POST',
      contentType: 'application/json',
      data: JSON.stringify({
        productId: productId,
        productDetails: { name: productName, price: productPrice }
      }),
      success: function (response) {
        Swal.fire({
          icon: 'success',
          title: `${productName} added to cart!`,
          text: `Price: ₹${productPrice}`,
          showCancelButton: true,
          confirmButtonText: 'Go to Cart',
          cancelButtonText: 'Continue Shopping'
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = '/cartPage';
          }
        });
      },
      error: function (error) {
        Swal.fire({
          icon: 'error',
          title: 'Failed to add product to cart!',
          text: 'Please try again later.',
        });
      }
    });
  }


  function addTowishlist(productId) {
  $.ajax({
    url: '/addTowishlist',
    method: 'POST',
    data: { productId: productId },
    success: (response) => {
      if (response.status) {
        Swal.fire({
          title: 'Added to wishlist',
          text: 'The product has been added to your wishlist.',
          icon: 'success',
          timer: 2000,
        });
      } else {
        Swal.fire({
          title: 'Already in wishlist',
          text: response.message,
          icon: 'info',
          timer: 2000,
        });
      }
    },
    error: (error) => {
      Swal.fire({
        title: 'Error',
        text: 'There was an error adding the product to your wishlist.',
        icon: 'error',
        timer: 2000,
      });
      console.error("Error:", error);
    },
  });
}





</script>

<%- include("../../views/partials/user/footer") %>
